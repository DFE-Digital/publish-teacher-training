<% content_for :page_title,
               title_with_error_prefix(
                 t(".page_title", course_name_and_code: @course.name_and_code),
                 @what_you_will_study_form.errors.any?,
               ) %>
<% if params[:copy_from].present? && @copied_fields.any? %>
  <%= render Providers::CopyCourseContentWarningComponent.new(
    @copied_fields,
    "publish-course-information-form",
    @source_course,
  ) %>
<% end %>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <%= form_with(
          model: @what_you_will_study_form,
          url: fields_what_you_will_study_publish_provider_recruitment_cycle_course_path(@provider.provider_code,
                                                                                 @course.recruitment_cycle_year,
                                                                                 @course.course_code),
          method: :patch,
          local: true,
        ) do |f| %>
      <% content_for :before_content do %>
        <%= govuk_back_link_to(
              back_link_path(
                param_form_key: f.object_name.to_sym,
                params:,
                provider_code: @provider.provider_code,
                recruitment_cycle_year: @course.recruitment_cycle_year,
                course_code: @course.course_code,
              ),
            ) %>
      <% end %>
      <%= f.govuk_error_summary %>
      <h1 class="govuk-heading-l">
        <span class="govuk-caption-l"><%= @course.name_and_code %></span>
        <%= t(".page_title") %>
      </h1>
      <% if @v1_enrichment %>
        <%= render(
    partial: "publish/courses/fields/last_cycle_recap",
    locals: {
      texts: [
        [t(".about_this_course"), @v1_enrichment&.about_course],
        [t(".how_placements_work"), @v1_enrichment&.how_school_placements_work],
      ],
    },
  ) %>
      <% end %>
      <%= render(
        partial: "publish/courses/markdown_formatting",
        locals: {
          course: @course,
          page_path: fields_what_you_will_study_publish_provider_recruitment_cycle_course_path(
            @provider.provider_code,
            @course.recruitment_cycle_year,
            @course.course_code,
          ),
        },
      ) %>
      <div data-controller="input-preview">
        <%= f.govuk_text_area(:theoretical_training_activities,
          value: @copied_fields_values&.dig("theoretical_training_activities"),
          data: {
            input_preview_target: "input",
            action: "input-preview#updatePreview",
            preview_output_target: "shared",
          },
          label: { text: t(".theoretical_training_activities"), size: "s" },
          hint: { text: t(".theoretical_training_activities_hint"), size: "s" },
          rows: 5,
          max_words: 150) %>
        <%= f.govuk_text_area(:assessment_methods,
          value: @copied_fields_values&.dig("assessment_methods"),
          data: {
            input_preview_target: "input",
            action: "input-preview#updatePreview",
            preview_output_target: "shared",
          },
          label: { text: t(".assessment_methods"), size: "s" },
          rows: 5,
          max_words: 50) %>
        <%= render partial: "publish/courses/fields/dynamic_preview", locals: { preview_heading: t(".preview_heading") } %>
      </div>
      <%= f.govuk_submit t(".submit_button") %>
    <% end %>
    <p class="govuk-body">
      <%= govuk_link_to(
            t("cancel"),
            publish_provider_recruitment_cycle_course_path(
              @provider.provider_code,
              @provider.recruitment_cycle.year,
              @course.course_code,
            ),
          ) %>
    </p>
  </div>
  <aside class="govuk-grid-column-one-third" data-qa="course__related_sidebar">
    <%= render(
      partial: "publish/courses/related_sidebar",
      locals: {
        course: @course,
        page_path: fields_what_you_will_study_publish_provider_recruitment_cycle_course_path(
          @provider.provider_code,
          @course.recruitment_cycle_year,
          @course.course_code,
        ),
      },
    ) %>
  </aside>
</div>
