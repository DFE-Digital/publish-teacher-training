<% content_for :page_title, @provider.rolled_over? ? "Courses â€“ #{@recruitment_cycle.title}" : "Courses" %>
<%= content_for :before_content, render_breadcrumbs(:courses) %>

<h1 class="govuk-heading-l">Courses</h1>

<% if (current_recruitment_cycle?(@provider) || @provider.study_sites.any? || !FeatureService.enabled?(:study_sites)) %>

  <%= govuk_button_link_to(
    "Add course",
    new_publish_provider_recruitment_cycle_course_path(
      provider_code: @provider.provider_code,
      recruitment_cycle_year: @provider.recruitment_cycle_year
    ),
    class: "govuk-!-margin-bottom-6"
  ) %>

<% else %>

  <div class="govuk-inset-text">
    <p class="govuk-body">Before adding a course, you need to:</p>
    <ul class="govuk-list govuk-list--bullet">
        <li>
          <%= govuk_link_to("Add a study site", publish_provider_recruitment_cycle_study_sites_path(@provider.provider_code, @provider.recruitment_cycle_year)) %>
        </li>
    </ul>
  </div>
<% end %>

<% if @self_accredited_courses %>
  <section data-qa="courses__table-section">
    <%= render partial: "course_table", locals: { courses: @self_accredited_courses } %>
  </section>
<% end %>

<% @courses_by_accrediting_provider.each do |accrediting_provider, courses| %>
  <section data-qa="courses__table-section">
    <h2 class="govuk-heading-m">
      <span class="govuk-caption-m">Accredited provider</span>
      <%= accrediting_provider %>
    </h2>

    <%= render partial: "course_table", locals: { courses: } %>
  </section>
<% end %>
