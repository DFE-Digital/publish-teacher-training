<div class="filtering-sorting">
  <%= content_for :page_title, t(".page_title", count: @courses_count, formatted_count: number_with_delimiter(@courses_count)) %>

  <h1 class="govuk-heading-xl">
    <%= t(".page_title", count: @courses_count, formatted_count: number_with_delimiter(@courses_count)) %>
  </h1>

  <%= render Courses::QueryDebugHeaderComponent.new(
  results: @results,
  applied_filters: @courses_query.applied_scopes,
  latitude: @search_params[:latitude],
  longitude: @search_params[:longitude],
  debug: params[:debug],
) %>

  <%= form_with model: @search_courses_form, scope: "", url: find_results_path, method: :get do |form| %>
    <%= form.hidden_field :utm_source, value: "results" %>

    <div class="app-filter-layout">
      <div class="govuk-grid-column-one-third">
        <div class="govuk-grid-row">
          <h2 class="govuk-heading-m"><%= t(".filter_results") %></h2>

          <%= render "find/results/filters/all", form: %>
        </div>
      </div>

      <div class="govuk-grid-column-two-thirds">
        <%= render partial: "find/results/courses_guidance/show" %>

        <div class="app-search-results-controls">
          <div class="govuk-form-group" data-controller="subjects-autocomplete">
            <%= render DfE::Autocomplete::View.new(
             form,
             attribute_name: :subject_code,
             form_field: form.govuk_select(
               :subject_code,
               options_for_select(
                 dfe_autocomplete_options(form.object.all_subjects, synonyms_fields: %i[subject_code match_synonyms]),
                 form.object.subject_code,
               ),
               label: { text: t("helpers.label.courses_search_form.subject_name"), size: "s" },
             ),
           ) %>
          </div>

          <%= form.govuk_text_field :location,
          label: { text: t("helpers.label.courses_search_form.location"), size: "s" },
          form_group: {
            "data-controller" => "locations-autocomplete",
            "data-locations-autocomplete-path-value" => find_geolocation_suggestions_path,
          },
          autocomplete: "off",
          data: { locations_autocomplete_target: "input" } %>

          <%= form.govuk_submit t("helpers.submit.courses_search_form.search"), name: "utm_medium", value: "search" %>
        </div>

        <% if @results.present? %>
          <ul class="app-search-results">
            <% @results.each do |course| %>
              <%= render Courses::SummaryCardComponent.new(
              candidate: @candidate,
              course:,
              location: @address.short_address,
              visa_sponsorship: @search_params[:can_sponsor_visa],
            ) %>

              <%= render Courses::SchoolDistancesDebugComponent.new(
              course:,
              latitude: @search_params[:latitude],
              longitude: @search_params[:longitude],
              debug: params[:debug],
            ) %>
            <% end %>
          </ul>

          <%= render partial: "find/results/courses_guidance/show" %>
          <%= govuk_pagination(pagy: @pagy) %>
        <% else %>
          <button type="button" class="govuk-button govuk-button--secondary app-filter__toggle govuk-!-margin-top-5" aria-haspopup="true" aria-expanded="false" data-visibility-target="trigger" data-action="visibility#show">
            Filter results
          </button>

          <%= render Courses::NoResultsComponent.new(search_params: @search_params) %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
