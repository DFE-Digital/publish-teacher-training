<%= govuk_table do |table| %>
  <% table.with_head do |head| %>
    <% head.with_row do |row| %>
      <% row.with_cell text: t(".email_address") %>
      <% row.with_cell do %>
        <% current_sort = params[:sort] %>
        <% next_sort = current_sort == "created_at_desc" ? "created_at_asc" : "created_at_desc" %>
        <% arrow = if current_sort == "created_at_desc"
                     " ↓"
                   else
                     (current_sort == "created_at_asc" ? " ↑" : "")
                   end %>
        <%= link_to "#{t('.created_at')}#{arrow}", url_for(request.query_parameters.merge(sort: next_sort, page: nil)), class: "govuk-link" %>
      <% end %>
    <% end %>
  <% end %>
  <% table.with_body do |body| %>
    <% candidates.each do |candidate| %>
      <% body.with_row classes: %w[course-row] do |row| %>
        <% row.with_cell text: govuk_link_to(candidate.email_address, details_support_candidate_path(candidate), class: "govuk-link") %>
        <% row.with_cell text: "#{candidate.created_at.to_fs(:govuk_date_and_time)} (#{time_ago_in_words(candidate.created_at)} ago)" %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
